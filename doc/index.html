<!DOCTYPE html>
<html>
  <head>
    <title>OdbResource and OdbRealm</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <style type="text/css"><!--
      body {
        font-family: Helvetica, sans-serif;
        font-size: 12pt;
        margin-left: 5px;
        margin-right: 5px;
        margin-top: 0px;
        margin-bottom: 0px;
        text-align: center;
      }

      a {
        text-decoration: none;
        color: #0d528b;
      }

      a:visited {
        color: #88a5cb;
      }

      a:hover {
        text-decoration: underline;
      }

      table {
        border-collapse: collapse;
        font-size: 12pt;
        margin-left: auto;
        margin-right: auto;
        width: 100%;
      }

      td {
        border-style: solid;
        border-width: 1px;
        padding-left: 5px;
        padding-right: 5px;
        padding-top: 0px;
        padding-bottom: 0px;
        text-align: left;
        vertical-align: top;
      }

      th {
        border-style: solid;
        border-width: 1px;
        font-weight: bold;
        padding-left: 5px;
        padding-right: 5px;
        padding-top: 0px;
        padding-bottom: 0px;
        text-align: left;
        vertical-align: center;
      }

      .title {
        margin: 10px;
        padding: 10px;
      }

      .content {
        font-size: 12pt;
        margin-left: 25px;
        margin-right: 25px;
        padding-left: 10px;
        padding-right: 10px;
        text-align: justify;
      }

      .divider {
        background-color: #0d528b;
        color: #0d528b;
        height: 1px;
        margin: 25px;
        border: 1px;
        padding: 1px;
      }

      .logln {
        font-size: 12pt;
        font-weight: bold;
        margin-top: 10px;
        margin-bottom: 10px;
        padding: 10px;
      }

      .menu {
        white-space: nowrap;
      }

      .mitem {
        font-style: italic;
        font-weight: bold;
        padding: 5px;
        white-space: nowrap;
      }

      .sitem {
        color: #a7a6a6;
        font-weight: bold;
        padding: 5px;
        white-space: nowrap;
      }

      .footer {
        font-size: 8pt;
        font-weight: bold;
        white-space: nowrap;
        position: fixed;
        bottom: 25px;
        right: 25px;
      }

      .noframe {
        border-style: none;
        padding: 3px;
        white-space: nowrap;
      }
    --></style>
  </head>
  <body>
    <h1>OdbResource and OdbRealm</h1>
    <div>
      <hr class="divider"/>
    </div>

    <h2>Useful Links</h2>
    <p>
      <strong><a href="api/index.html">OdbResource and OdbRealm Javadocs</a></strong>
    </p>
    <p>
      <a href="http://orientdb.com/docs/last/">OrientDB Manual</a>
    </p>
    <p>
      <a href="http://tomcat.apache.org/tomcat-8.0-doc/index.html">Apache Tomcat 8 Documentation</a>
    </p>
    <p>
      <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a>
    </p>
    <div>
      <hr class="divider"/>
    </div>

    <h2>Introduction</h2>
    <div class="content">
      <p>
        <a href="http://orientdb.com/">OrientDB</a> was a product that I
        stumbled across a year or two ago. I instantly fell in love with what
        they were trying to do. A graph database with features of
        document-oriented databases that could be run standalone or embedded.
        ACID transactions, multi-master replication and record level security!
      </p>
      <p>
        The only reasons I could imagine why more people weren't using were:
        <ol>
          <li>
            It was very new.
          </li>
          <li>
            Graph databases represent a paradigm shift and therefore a steep
            learning curve compared with most other databases.
          </li>
        </ol>
      </p>
      <p>
        After playing around with it for a short time, I saw the possibility of
        using it for web applications in a way that would improve security
        while simultaneously removing some of the boilerplate that usually has
        to be written. But there were some issues, mostly because OrientDB's
        connection pooling hadn't been designed with this architecture in mind.
      </p>
      <p>
        OdbResource is not so much a solution to these issues as a proof of
        concept for the architecture I am suggesting. It is an implementation
        of a pool for OrientGraph instances that can be bound to a JNDI service
        and comes with OdbRealm, an OrientDB realm for Tomcat. It is far from
        an ideal implementation though, for reasons discussed
        <a href="whitepaper.html">elsewhere</a>.
      </p>
      <p>
        The user guide is just below and a discussion of (and argument for) the
        architecture is <em><a href="whitepaper.html">here</a></em>.
      </p>
    </div>
    <div>
      <hr class="divider"/>
    </div>

    <h2>User Guide</h2>
    <div class="content">
      <p>
        This guide covers the use of OdbResource and OdbRealm with Tomcat.
      </p>

      <div class="content">
        <h3>Download and Install</h3>
        <p>
          <ol>
            <li>
              Download the latest binary release from the
              <a href="https://github.com/skwidge/OdbResource/releases/"
                 target="_blank">OdbResource release page on Github</a>. Or
              download the source and build the <strong>dist</strong> target.
            </li>
            <li>
              Unzip the file odbresource-[<em>version number</em>].zip in the lib
              directory of Apache Tomcat.
            </li>
          </ol>
        </p>

        <h3>Configuration</h3>
        <p>
          There are two components that have to be configured at either the
          context or server level. (context.xml or server.xml) They are the
          Resource and the Realm.
        </p>

        <div class="content">
          <h4>OdbResource</h4>
          <p>
            The OrientGraphPoolFactory class must be configured as a JNDI
            Resource in Tomcat. This must be done in either server.xml or the
            context.xml file for the web application.
          </p>
          <p>
            Putting the configuration in server.xml is generally more
            appropriate. The OServer instance runs as a singleton anyway so the
            configuration is effectively global wherever you put it. Two
            different configurations in different context.xml files would
            result in undefined behaviour. Most likely the first application to
            be loaded would override any others.
          </p>
          <p>
            <a href="https://tomcat.apache.org/tomcat-8.0-doc/config/context.html#Resource_Definitions">Tomcat's
              guide on resource configuration is here</a>. Important things to
            note for OdbResource configuration are:
            <ol>
              <li>
                The auth attribute must have a value of "Container".
              </li>
              <li>
                The closeMethod attribute must have a value of "shutdown".
              </li>
              <li>
                The factory attribute must have a value of "com.ashtonit.odb.pool.OrientGraphPoolFactory".
              </li>
              <li>
                The type attribute must have a value of "com.ashtonit.odb.pool.OrientGraphPool".
              </li>
              <li>
                The singleton attribute must have a value of true, to ensure
                that the close method is run. (In fact the OrientGraphPool
                remains a singleton regardless of this attribute.)
              </li>
            </ol>
          </p>
          <p>
            An example of a minimal resource definition would be:
            <pre>
              &lt;Resource
                 auth="Container"
                 closeMethod="shutdown"
                 configFile="/mnt/share/orientdb-community-2.1/config/orientdb-server-config.xml"
                 factory="com.ashtonit.odb.pool.OrientGraphPoolFactory"
                 name="odbp"
                 singleton="true"
                 type="com.ashtonit.odb.pool.OrientGraphPool"
               /&gt;
            </pre>
            The only attribute in the above element that is not described in the
            Tomcat configuration guide is <strong>configFile</strong>. The value
            should be the name of the OrientDB server configuration file. Refer
            to the OrientDB manual if you edit this file. I have generally left
            it untouched.
          </p>
          <p>
            A complete resource definition with all optional attributes is:
            <pre>
              &lt;Resource
                 auth="Container"
                 closeMethod="shutdown"
                 configFile="/mnt/share/orientdb-community-2.1/config/orientdb-server-config.xml"
                 factory="com.ashtonit.odb.pool.OrientGraphPoolFactory"
                 name="odbp"
                 singleton="true"
                 type="com.ashtonit.odb.pool.OrientGraphPool"
                 commitOnShutdown="true"
                 getWait="1000"
                 perUserLimit="10"
                 recycleCount="3"
                 timeOut="10000"
                 totalLimit="1000"
               /&gt;
            </pre>
            An explanation of all the optional attributes above can be found in
            the description of configuration parameters in the
            <a href="file:///mnt/share/code/OdbResource/doc/api/com/ashtonit/odb/pool/OrientGraphPoolFactory.html"
               target="_blank">javadocs for the OrientGraphPoolFactory
              class</a>.
          </p>

          <h4>OdbRealm</h4>
          <p>
            Configuring the realm
          </p>
        </div>
      </div>
    </div>

    <div>
      <hr class="divider"/>
    </div>
    
    <div class="footer">
      &copy; Copyright Bruce Ashton 2015
    </div>
  </body>
</html>
